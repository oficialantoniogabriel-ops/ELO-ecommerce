<!DOCTYPE html>
<html lang="pt-AO">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel - ELO Commerce</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {background:#000;color:#fff;font-family:"Poppins",sans-serif;}
    .navbar {background:linear-gradient(90deg,#b8860b 0%,#000 100%);}
    .navbar-brand {font-weight:bold;color:#fff!important;}
    .container {margin-top:100px;}
    .btn-gold {background-color:#b8860b;color:#fff;border:none;border-radius:25px;padding:10px 20px;font-weight:600;}
    .btn-gold:hover {background-color:#ffcc00;color:#000;}
    .card {background:#111;border:1px solid #222;border-radius:10px;}
    .card h5 {color:#ffcc00;}
    .form-control {background:#222;border:1px solid #333;color:#fff;}
    .form-control:focus {border-color:#b8860b;box-shadow:none;}
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand">‚öúÔ∏è ELO Commerce</a>
    <div>
      <button id="homeBtn" class="btn btn-outline-light me-2">üè† In√≠cio</button>
      <button id="logoutBtn" class="btn btn-outline-danger">Sair</button>
    </div>
  </div>
</nav>

<!-- Conte√∫do -->
<div class="container">
  <h2 class="text-warning mb-4 text-center">üíº Painel do Usu√°rio</h2>

  <!-- Saldo -->
  <div class="card p-3 mb-4">
    <h5>Carteira</h5>
    <p>Saldo dispon√≠vel: <strong id="saldo">0.00 KZ</strong></p>
    <button id="addFundsBtn" class="btn-gold me-2">‚ûï Adicionar Fundos</button>
    <button id="withdrawBtn" class="btn btn-outline-light">üí∏ Sacar</button>
  </div>

  <!-- Criar produto -->
  <div class="card p-3 mb-4">
    <h5>üì¶ Criar Novo Produto</h5>
    <form id="produtoForm">
      <input type="text" class="form-control mb-2" id="nomeProduto" placeholder="Nome do produto" required>
      <textarea class="form-control mb-2" id="descricaoProduto" placeholder="Descri√ß√£o do produto"></textarea>
      <input type="number" class="form-control mb-2" id="precoProduto" placeholder="Pre√ßo (KZ)" required>
      <input type="file" class="form-control mb-2" id="arquivoProduto" accept="image/*,video/*">
      <button type="submit" class="btn-gold w-100">Salvar Produto</button>
    </form>
  </div>

  <!-- Lista de produtos -->
  <div class="card p-3 mb-4">
    <h5>üõçÔ∏è Meus Produtos</h5>
    <div id="listaProdutos" class="mt-3"></div>
  </div>
</div>

<footer class="text-center mt-5 py-3 bg-black text-secondary">
  &copy; 2025 ELO Commerce. Todos os direitos reservados.
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAN_7vyt0XcOt6NvOE6MDoBCajUjhToCR0",
    authDomain: "elo-ecommerce-ecd87.firebaseapp.com",
    projectId: "elo-ecommerce-ecd87",
    storageBucket: "elo-ecommerce-ecd87.appspot.com",
    messagingSenderId: "375574231770",
    appId: "1:375574231770:web:78279cb6aac72c454703e3"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const saldoEl = document.getElementById("saldo");
  const produtoForm = document.getElementById("produtoForm");
  const listaProdutos = document.getElementById("listaProdutos");

  let userEmail = "";

  // üîπ Verifica login
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }
    userEmail = user.email;
    await carregarCarteira();
    await carregarProdutos();
  });

  // üîπ Bot√£o sair
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "index.html";
  });

  // üîπ Voltar ao in√≠cio
  document.getElementById("homeBtn").addEventListener("click", () => {
    window.location.href = "index.html";
  });

  // üîπ Carregar carteira
  async function carregarCarteira() {
    const refDoc = doc(db, "usuarios", userEmail);
    const snap = await getDoc(refDoc);
    if (snap.exists()) {
      const data = snap.data();
      saldoEl.textContent = `${(data.saldo ?? 0).toFixed(2)} KZ`;
    } else {
      await setDoc(refDoc, { email: userEmail, saldo: 0 });
    }
  }

  // üîπ Criar produto
  produtoForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const nome = document.getElementById("nomeProduto").value;
    const descricao = document.getElementById("descricaoProduto").value;
    const preco = parseFloat(document.getElementById("precoProduto").value);
    const arquivo = document.getElementById("arquivoProduto").files[0];
    let arquivoURL = "";

    try {
      if (arquivo) {
        const fileRef = ref(storage, "produtos/" + userEmail + "/" + arquivo.name);
        await uploadBytes(fileRef, arquivo);
        arquivoURL = await getDownloadURL(fileRef);
      }

      await addDoc(collection(db, "produtos"), {
        nome, descricao, preco, arquivoURL,
        vendedor: userEmail,
        criadoEm: new Date()
      });

      alert("‚úÖ Produto salvo com sucesso!");
      produtoForm.reset();
      carregarProdutos();
    } catch (err) {
      alert("Erro ao salvar: " + err.message);
    }
  });

  // üîπ Carregar produtos do usu√°rio
  async function carregarProdutos() {
    listaProdutos.innerHTML = "<p>Carregando...</p>";
    const q = query(collection(db, "produtos"), where("vendedor", "==", userEmail));
    const snap = await getDocs(q);
    if (snap.empty) {
      listaProdutos.innerHTML = "<p class='text-muted'>Nenhum produto cadastrado.</p>";
      return;
    }
    let html = "";
    snap.forEach(docSnap => {
      const p = docSnap.data();
      html += `
        <div class="border p-3 mb-3 rounded">
          <h6>${p.nome}</h6>
          <p>${p.descricao ?? ""}</p>
          <p><strong>${p.preco} KZ</strong></p>
          ${p.arquivoURL ? `<img src="${p.arquivoURL}" width="120" class="rounded">` : ""}
        </div>`;
    });
    listaProdutos.innerHTML = html;
  }
</script>

</body>
        </html><!DOCTYPE html>
<html lang="pt-AO">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel - ELO Commerce</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {background:#000;color:#fff;font-family:"Poppins",sans-serif;}
    .navbar {background:linear-gradient(90deg,#b8860b 0%,#000 100%);}
    .navbar-brand {font-weight:bold;color:#fff!important;}
    .container {margin-top:100px;}
    .btn-gold {background-color:#b8860b;color:#fff;border:none;border-radius:25px;padding:10px 20px;font-weight:600;}
    .btn-gold:hover {background-color:#ffcc00;color:#000;}
    .card {background:#111;border:1px solid #222;border-radius:10px;}
    .card h5 {color:#ffcc00;}
    .form-control {background:#222;border:1px solid #333;color:#fff;}
    .form-control:focus {border-color:#b8860b;box-shadow:none;}
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand">‚öúÔ∏è ELO Commerce</a>
    <div>
      <button id="homeBtn" class="btn btn-outline-light me-2">üè† In√≠cio</button>
      <button id="logoutBtn" class="btn btn-outline-danger">Sair</button>
    </div>
  </div>
</nav>

<!-- Conte√∫do -->
<div class="container">
  <h2 class="text-warning mb-4 text-center">üíº Painel do Usu√°rio</h2>

  <!-- Saldo -->
  <div class="card p-3 mb-4">
    <h5>Carteira</h5>
    <p>Saldo dispon√≠vel: <strong id="saldo">0.00 KZ</strong></p>
    <button id="addFundsBtn" class="btn-gold me-2">‚ûï Adicionar Fundos</button>
    <button id="withdrawBtn" class="btn btn-outline-light">üí∏ Sacar</button>
  </div>

  <!-- Criar produto -->
  <div class="card p-3 mb-4">
    <h5>üì¶ Criar Novo Produto</h5>
    <form id="produtoForm">
      <input type="text" class="form-control mb-2" id="nomeProduto" placeholder="Nome do produto" required>
      <textarea class="form-control mb-2" id="descricaoProduto" placeholder="Descri√ß√£o do produto"></textarea>
      <input type="number" class="form-control mb-2" id="precoProduto" placeholder="Pre√ßo (KZ)" required>
      <input type="file" class="form-control mb-2" id="arquivoProduto" accept="image/*,video/*">
      <button type="submit" class="btn-gold w-100">Salvar Produto</button>
    </form>
  </div>

  <!-- Lista de produtos -->
  <div class="card p-3 mb-4">
    <h5>üõçÔ∏è Meus Produtos</h5>
    <div id="listaProdutos" class="mt-3"></div>
  </div>
</div>

<footer class="text-center mt-5 py-3 bg-black text-secondary">
  &copy; 2025 ELO Commerce. Todos os direitos reservados.
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, setDoc, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAN_7vyt0XcOt6NvOE6MDoBCajUjhToCR0",
    authDomain: "elo-ecommerce-ecd87.firebaseapp.com",
    projectId: "elo-ecommerce-ecd87",
    storageBucket: "elo-ecommerce-ecd87.appspot.com",
    messagingSenderId: "375574231770",
    appId: "1:375574231770:web:78279cb6aac72c454703e3"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  const saldoEl = document.getElementById("saldo");
  const produtoForm = document.getElementById("produtoForm");
  const listaProdutos = document.getElementById("listaProdutos");

  let userEmail = "";

  // üîπ Verifica login
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }
    userEmail = user.email;
    await carregarCarteira();
    await carregarProdutos();
  });

  // üîπ Bot√£o sair
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "index.html";
  });

  // üîπ Voltar ao in√≠cio
  document.getElementById("homeBtn").addEventListener("click", () => {
    window.location.href = "index.html";
  });

  // üîπ Carregar carteira
  async function carregarCarteira() {
    const refDoc = doc(db, "usuarios", userEmail);
    const snap = await getDoc(refDoc);
    if (snap.exists()) {
      const data = snap.data();
      saldoEl.textContent = `${(data.saldo ?? 0).toFixed(2)} KZ`;
    } else {
      await setDoc(refDoc, { email: userEmail, saldo: 0 });
    }
  }

  // üîπ Criar produto
  produtoForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const nome = document.getElementById("nomeProduto").value;
    const descricao = document.getElementById("descricaoProduto").value;
    const preco = parseFloat(document.getElementById("precoProduto").value);
    const arquivo = document.getElementById("arquivoProduto").files[0];
    let arquivoURL = "";

    try {
      if (arquivo) {
        const fileRef = ref(storage, "produtos/" + userEmail + "/" + arquivo.name);
        await uploadBytes(fileRef, arquivo);
        arquivoURL = await getDownloadURL(fileRef);
      }

      await addDoc(collection(db, "produtos"), {
        nome, descricao, preco, arquivoURL,
        vendedor: userEmail,
        criadoEm: new Date()
      });

      alert("‚úÖ Produto salvo com sucesso!");
      produtoForm.reset();
      carregarProdutos();
    } catch (err) {
      alert("Erro ao salvar: " + err.message);
    }
  });

  // üîπ Carregar produtos do usu√°rio
  async function carregarProdutos() {
    listaProdutos.innerHTML = "<p>Carregando...</p>";
    const q = query(collection(db, "produtos"), where("vendedor", "==", userEmail));
    const snap = await getDocs(q);
    if (snap.empty) {
      listaProdutos.innerHTML = "<p class='text-muted'>Nenhum produto cadastrado.</p>";
      return;
    }
    let html = "";
    snap.forEach(docSnap => {
      const p = docSnap.data();
      html += `
        <div class="border p-3 mb-3 rounded">
          <h6>${p.nome}</h6>
          <p>${p.descricao ?? ""}</p>
          <p><strong>${p.preco} KZ</strong></p>
          ${p.arquivoURL ? `<img src="${p.arquivoURL}" width="120" class="rounded">` : ""}
        </div>`;
    });
    listaProdutos.innerHTML = html;
  }
</script>

</body>
  </html>
