<!DOCTYPE html>
<html lang="pt-AO">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel - ELO Commerce</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a2e0e6ad3b.js" crossorigin="anonymous"></script>
  <style>
    body {
      background-color: #fff;
      color: #000;
      font-family: "Poppins", sans-serif;
    }
    .navbar {
      background: linear-gradient(90deg, #b8860b, #fff);
      padding: 10px;
    }
    .navbar-brand {
      font-weight: bold;
      color: #000;
    }
    .sidebar {
      background-color: #f8f8f8;
      padding-top: 20px;
      height: 100vh;
      position: fixed;
      width: 220px;
      border-right: 2px solid #b8860b;
    }
    .sidebar a {
      color: #b8860b;
      display: block;
      padding: 12px 20px;
      text-decoration: none;
      transition: 0.3s;
      font-weight: 500;
    }
    .sidebar a:hover {
      background-color: #b8860b;
      color: #fff;
    }
    .content {
      margin-left: 230px;
      padding: 25px;
    }
    .btn-gold {
      background-color: #b8860b;
      border: none;
      color: #fff;
      border-radius: 20px;
      padding: 8px 16px;
      transition: 0.3s;
    }
    .btn-gold:hover {
      background-color: #ffcc00;
      color: #000;
    }
    .card {
      background-color: #fff8e1;
      border: 1px solid #b8860b;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h5 {
      color: #b8860b;
    }
    @media(max-width:768px){
      .sidebar {width:100%; height:auto; position:relative; display:flex; overflow-x:auto;}
      .sidebar a {flex:1; text-align:center;}
      .content {margin-left:0;}
    }
  </style>
</head>
<body>

<nav class="navbar navbar-light">
  <div class="container-fluid">
    <a class="navbar-brand"><i class="fas fa-store"></i> ELO Commerce</a>
    <button id="logoutBtn" class="btn btn-outline-dark">Sair</button>
  </div>
</nav>

<div class="sidebar">
  <a href="#" data-section="inicio"><i class="fas fa-home"></i> In√≠cio</a>
  <a href="#" data-section="produtos"><i class="fas fa-box"></i> Produtos</a>
  <a href="#" data-section="vendas"><i class="fas fa-shopping-cart"></i> Vendas</a>
  <a href="#" data-section="carteira"><i class="fas fa-wallet"></i> Carteira</a>
  <a href="#" data-section="perfil"><i class="fas fa-user-circle"></i> Perfil</a>
</div>

<div class="content">
  <div id="conteudo">
    <h3 class="text-warning">Bem-vindo(a) √† sua loja ELO Commerce!</h3>
    <p>Gerencie produtos, vendas e sua carteira aqui.</p>
  </div>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAN_7vyt0XcOt6NvOE6MDoBCajUjhToCR0",
    authDomain: "elo-ecommerce-ecd87.firebaseapp.com",
    projectId: "elo-ecommerce-ecd87",
    storageBucket: "elo-ecommerce-ecd87.appspot.com",
    messagingSenderId: "375574231770",
    appId: "1:375574231770:web:78279cb6aac72c454703e3"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const conteudo = document.getElementById("conteudo");

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    // üîπ Cria carteira se n√£o existir
    const carteiraRef = doc(db, "carteira", user.email);
    const carteiraSnap = await getDoc(carteiraRef);
    if (!carteiraSnap.exists()) {
      await setDoc(carteiraRef, { saldoKZ: 0, saldoUSD: 0, dono: user.email });
    }
  });

  // üîπ Logout
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "login.html";
  });

  // üîπ Se√ß√µes
  async function carregarSecao(sec) {
    if (sec === "inicio") {
      conteudo.innerHTML = `<h4 class='text-warning'>üìä Painel Geral</h4>
      <p>Acompanhe suas vendas, carteira e produtos.</p>`;
    }

    // üõçÔ∏è Produtos
    if (sec === "produtos") {
      conteudo.innerHTML = `
        <h4 class='text-warning mb-3'>üõçÔ∏è Seus Produtos</h4>
        <button class="btn-gold mb-3" id="novoProduto">+ Novo Produto</button>
        <div id="listaProdutos">Carregando...</div>
      `;

      const snap = await getDocs(collection(db, "produtos"));
      let html = "";
      snap.forEach(docSnap => {
        const p = docSnap.data();
        if (p.vendedor === auth.currentUser.email) {
          html += `
            <div class="card">
              <h5>${p.nome}</h5>
              <img src="${p.imagem || 'https://via.placeholder.com/200'}" class="img-fluid rounded mb-2" width="150">
              <p>${p.descricao}</p>
              <p><b>Pre√ßo:</b> ${p.preco} KZ</p>
            </div>`;
        }
      });
      document.getElementById("listaProdutos").innerHTML = html || "<p>Nenhum produto cadastrado.</p>";

      document.getElementById("novoProduto").addEventListener("click", () => {
        conteudo.innerHTML = `
          <h4 class='text-warning'>Adicionar Produto</h4>
          <form id="formProduto" class="mt-3">
            <input type="text" class="form-control mb-2" id="nome" placeholder="Nome do produto" required>
            <input type="text" class="form-control mb-2" id="descricao" placeholder="Descri√ß√£o">
            <input type="number" class="form-control mb-2" id="preco" placeholder="Pre√ßo em KZ" required>
            <input type="url" class="form-control mb-2" id="imagem" placeholder="URL da imagem (opcional)">
            <button type="submit" class="btn-gold">Salvar Produto</button>
          </form>`;
        
        document.getElementById("formProduto").addEventListener("submit", async (e) => {
          e.preventDefault();
          const user = auth.currentUser;
          await addDoc(collection(db, "produtos"), {
            nome: nome.value,
            descricao: descricao.value,
            preco: parseFloat(preco.value),
            imagem: imagem.value,
            vendedor: user.email,
            data: new Date().toISOString()
          });
          alert("‚úÖ Produto criado com sucesso!");
          carregarSecao("produtos");
        });
      });
    }

    // üí∞ Carteira
    if (sec === "carteira") {
      const user = auth.currentUser;
      const docRef = doc(db, "carteira", user.email);
      const snap = await getDoc(docRef);
      const data = snap.data();

      conteudo.innerHTML = `
        <h4 class="text-warning">üí∞ Sua Carteira</h4>
        <p><b>Saldo (KZ):</b> ${data.saldoKZ.toFixed(2)}</p>
        <p><b>Saldo (USD):</b> ${data.saldoUSD.toFixed(2)}</p>
      `;
    }

    // üõí Vendas
    if (sec === "vendas") {
      conteudo.innerHTML = `<p class='text-warning'>üõí Suas vendas aparecer√£o aqui automaticamente.</p>`;
    }

    if (sec === "perfil") {
      conteudo.innerHTML = `
        <h4 class='text-warning'>üë§ Meu Perfil</h4>
        <p>Email: ${auth.currentUser.email}</p>
      `;
    }
  }

  document.querySelectorAll(".sidebar a").forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      carregarSecao(link.getAttribute("data-section"));
    });
  });
</script>

</body>
  </html>
